<script type="text/javascript" src="http://cdn.jsdelivr.net/particle-api-js/5/particle.min.js"></script>

<script>
//var Particle = require('particle-api-js');
var particle = null;
var token = null;

/*
particle.login({username: 'test5@test.com', password: 'test'}).then(
  function(data){
    console.log('API call completed on promise resolve: ', data.body.access_token);
    var token = data.body.access_token; // from result of particle.login
    var devicesPr = particle.listDevices({ auth: token });
    devicesPr.then(
      function(devices){
        console.log('Devices before: ', devices);
      },
      function(err) {
        console.log('List devices call failed: ', err);
      }
    );

     //var claimID = window.location.hash.substring(1); //Puts hash in variable, and removes the # character
     var claimID = '33003c000a47353235303037';
     console.log('deviceId', claimID);
     console.log('auth', token);
     particle.claimDevice({ deviceId: claimID, auth: token }).then(function(data) {
       console.log('device claim data:', data);
     }, function(err) {
       console.log('device claim err:', err);
     });

     devicesPr = particle.listDevices({ auth: token });
     devicesPr.then(
       function(devices){
         console.log('Devices after: ', devices);
       },
       function(err) {
         console.log('List devices call failed: ', err);
       }
     );


  },
  function(err) {
    console.log('API call completed on promise fail: ', err);
  }
);*/

function login() {
  particle = new Particle();
  particle.login({username: document.getElementById("email").value, password: document.getElementById("password").value}).then(
    function(data){
      console.log('API call completed on promise resolve: ', data.body.access_token);
      token = data.body.access_token; // from result of particle.login
      document.getElementById("token").innerHTML = token;
    }
  );
}

function getDevices() {
  var devicesPr = particle.listDevices({ auth: token });
  devicesPr.then(
    function(devices){
      console.log('Devices before: ', devices);
      document.getElementById("devices").innerHTML = devices.body.length
    },
    function(err) {
      console.log('List devices call failed: ', err);
      document.getElementById("devices").innerHTML = err.body.length;
    }
  );
}

function claimDevice() {
  //var claimID = window.location.hash.substring(1); //Puts hash in variable, and removes the # character
  //var claimID = '33003c000a47353235303037';
  var claimID = document.getElementById("deviceid").value;
  console.log('deviceId', claimID);
  console.log('auth', token);
  particle.claimDevice({ deviceId: claimID, auth: token }).then(function(data) {
    console.log('device claim data:', data);
  }, function(err) {
    console.log('device claim err:', err);
  });
}

</script>

<form action="https://api.particle.io/v1/products/wifidoorbell-v100/customers" method="post">
    <input type="hidden" name="response_type" value="token" />
    <input type="hidden" name="client_id" value="testdoorbelloauth-3991" />
    <div class="form-group">
        <input type="email" class="form-control" name="email" placeholder="Email">
    </div>
    <div class="form-group">
        <input type="password" class="form-control" name="password" placeholder="Password">
    </div>
    <input type="submit" class="btn btn-lg btn-primary btn-block" value="Create User" id="registration-submit">
 </form>

<input id="email" type="email" class="form-control" name="email" value="test5@test.com"><br>
<input id="password" type="password" class="form-control" name="password" value="test"><br>
<button onclick="login()">Login</button><br>
<textarea id="token"></textarea><br><br>

<button onclick="getDevices()">Get Devices</button><br>
<textarea id="devices"></textarea><br><br>

<input id="deviceid" type="text" class="form-control" name="deviceid" value="33003c000a47353235303037"><br>
<button onclick="claimDevice()">Claim Device</button><br>
